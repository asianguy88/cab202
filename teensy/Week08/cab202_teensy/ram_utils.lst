   1               		.file	"ram_utils.c"
   2               	__SP_H__ = 0x3e
   3               	__SP_L__ = 0x3d
   4               	__SREG__ = 0x3f
   5               	__tmp_reg__ = 0
   6               	__zero_reg__ = 1
   7               		.text
   8               	.Ltext0:
   9               		.cfi_sections	.debug_frame
  10               		.section	.text.estimate_alloc,"ax",@progbits
  11               	.global	estimate_alloc
  13               	estimate_alloc:
  14               	.LFB5:
  15               		.file 1 "ram_utils.c"
   1:ram_utils.c   **** /*
   2:ram_utils.c   ****  *  CAB202 Teensy Library (cab202_teensy)
   3:ram_utils.c   ****  *	ram_utils.c
   4:ram_utils.c   ****  *
   5:ram_utils.c   ****  *	J.Luck, May 2015
   6:ram_utils.c   ****  *	Queensland University of Technology
   7:ram_utils.c   ****  */
   8:ram_utils.c   **** #include "ram_utils.h"
   9:ram_utils.c   **** 
  10:ram_utils.c   **** int estimate_alloc(int len){
  16               		.loc 1 10 0
  17               		.cfi_startproc
  18               	.LVL0:
  19               	/* prologue: function */
  20               	/* frame size = 0 */
  21               	/* stack size = 0 */
  22               	.L__stack_usage = 0
  11:ram_utils.c   **** 	extern int __heap_start, *__brkval;
  12:ram_utils.c   **** 	int v;
  13:ram_utils.c   **** 	return (int) (&v - (__brkval == 0 ? (int) &__heap_start : (int) __brkval) - len);
  14:ram_utils.c   **** }
  23               		.loc 1 14 0
  24 0000 80E0      		ldi r24,0
  25 0002 90E0      		ldi r25,0
  26               	.LVL1:
  27 0004 0895      		ret
  28               		.cfi_endproc
  29               	.LFE5:
  31               		.section	.text.estimate_ram,"ax",@progbits
  32               	.global	estimate_ram
  34               	estimate_ram:
  35               	.LFB6:
  15:ram_utils.c   **** 
  16:ram_utils.c   **** int estimate_ram(void){
  36               		.loc 1 16 0
  37               		.cfi_startproc
  38               	/* prologue: function */
  39               	/* frame size = 0 */
  40               	/* stack size = 0 */
  41               	.L__stack_usage = 0
  17:ram_utils.c   ****   extern int __heap_start, *__brkval;
  18:ram_utils.c   ****   int v;
  19:ram_utils.c   ****   return (int) (&v - (__brkval == 0 ? (int) &__heap_start : (int) __brkval));
  20:ram_utils.c   **** }
  42               		.loc 1 20 0
  43 0000 80E0      		ldi r24,0
  44 0002 90E0      		ldi r25,0
  45 0004 0895      		ret
  46               		.cfi_endproc
  47               	.LFE6:
  49               		.section	.text.load_rom_bitmap,"ax",@progbits
  50               	.global	load_rom_bitmap
  52               	load_rom_bitmap:
  53               	.LFB7:
  21:ram_utils.c   **** 
  22:ram_utils.c   **** unsigned char* load_rom_bitmap(const unsigned char* source, int len){
  54               		.loc 1 22 0
  55               		.cfi_startproc
  56               	.LVL2:
  57 0000 0F93      		push r16
  58               	.LCFI0:
  59               		.cfi_def_cfa_offset 3
  60               		.cfi_offset 16, -2
  61 0002 1F93      		push r17
  62               	.LCFI1:
  63               		.cfi_def_cfa_offset 4
  64               		.cfi_offset 17, -3
  65 0004 CF93      		push r28
  66               	.LCFI2:
  67               		.cfi_def_cfa_offset 5
  68               		.cfi_offset 28, -4
  69 0006 DF93      		push r29
  70               	.LCFI3:
  71               		.cfi_def_cfa_offset 6
  72               		.cfi_offset 29, -5
  73               	/* prologue: function */
  74               	/* frame size = 0 */
  75               	/* stack size = 4 */
  76               	.L__stack_usage = 4
  77 0008 8C01      		movw r16,r24
  78 000a EB01      		movw r28,r22
  23:ram_utils.c   **** 
  24:ram_utils.c   **** 	/* allocate memory */
  25:ram_utils.c   **** 	unsigned char* heap_alloc = (unsigned char*)malloc(len);
  79               		.loc 1 25 0
  80 000c CB01      		movw r24,r22
  81               	.LVL3:
  82 000e 0E94 0000 		call malloc
  83               	.LVL4:
  26:ram_utils.c   **** 
  27:ram_utils.c   **** 	/* check we have heap space allocated */
  28:ram_utils.c   **** 	if(heap_alloc == NULL)
  84               		.loc 1 28 0
  85 0012 0097      		sbiw r24,0
  86 0014 01F0      		breq .L3
  87 0016 DC01      		movw r26,r24
  88 0018 20E0      		ldi r18,0
  89 001a 30E0      		ldi r19,0
  90               	.L5:
  91               	.LVL5:
  92               	.LBB2:
  29:ram_utils.c   **** 		return NULL;
  30:ram_utils.c   **** 
  31:ram_utils.c   **** 	/* copy bytes over */
  32:ram_utils.c   **** 	for(int i=0;i<len;i++)
  93               		.loc 1 32 0 discriminator 1
  94 001c 2C17      		cp r18,r28
  95 001e 3D07      		cpc r19,r29
  96 0020 04F0      		brlt .L6
  97               	.LVL6:
  98               	.L3:
  99               	/* epilogue start */
 100               	.LBE2:
  33:ram_utils.c   **** 		heap_alloc[i] = pgm_read_byte(&((source[i])));
  34:ram_utils.c   **** 
  35:ram_utils.c   **** 	/* return pointer to ram */
  36:ram_utils.c   **** 	return heap_alloc;
  37:ram_utils.c   **** }
 101               		.loc 1 37 0
 102 0022 DF91      		pop r29
 103 0024 CF91      		pop r28
 104               	.LVL7:
 105 0026 1F91      		pop r17
 106 0028 0F91      		pop r16
 107               	.LVL8:
 108 002a 0895      		ret
 109               	.LVL9:
 110               	.L6:
 111               	.LBB4:
 112               	.LBB3:
  33:ram_utils.c   **** 		heap_alloc[i] = pgm_read_byte(&((source[i])));
 113               		.loc 1 33 0 discriminator 3
 114 002c F801      		movw r30,r16
 115 002e E20F      		add r30,r18
 116 0030 F31F      		adc r31,r19
 117               	.LVL10:
 118               	/* #APP */
 119               	 ;  33 "ram_utils.c" 1
 120 0032 E491      		lpm r30, Z
 121               		
 122               	 ;  0 "" 2
 123               	.LVL11:
 124               	/* #NOAPP */
 125               	.LBE3:
 126 0034 ED93      		st X+,r30
  32:ram_utils.c   **** 		heap_alloc[i] = pgm_read_byte(&((source[i])));
 127               		.loc 1 32 0 discriminator 3
 128 0036 2F5F      		subi r18,-1
 129 0038 3F4F      		sbci r19,-1
 130               	.LVL12:
 131 003a 00C0      		rjmp .L5
 132               	.LBE4:
 133               		.cfi_endproc
 134               	.LFE7:
 136               		.section	.text.load_rom_string,"ax",@progbits
 137               	.global	load_rom_string
 139               	load_rom_string:
 140               	.LFB8:
  38:ram_utils.c   **** 
  39:ram_utils.c   **** unsigned char* load_rom_string(const unsigned char* source){
 141               		.loc 1 39 0
 142               		.cfi_startproc
 143               	.LVL13:
 144 0000 0F93      		push r16
 145               	.LCFI4:
 146               		.cfi_def_cfa_offset 3
 147               		.cfi_offset 16, -2
 148 0002 1F93      		push r17
 149               	.LCFI5:
 150               		.cfi_def_cfa_offset 4
 151               		.cfi_offset 17, -3
 152 0004 CF93      		push r28
 153               	.LCFI6:
 154               		.cfi_def_cfa_offset 5
 155               		.cfi_offset 28, -4
 156 0006 DF93      		push r29
 157               	.LCFI7:
 158               		.cfi_def_cfa_offset 6
 159               		.cfi_offset 29, -5
 160               	/* prologue: function */
 161               	/* frame size = 0 */
 162               	/* stack size = 4 */
 163               	.L__stack_usage = 4
 164 0008 8C01      		movw r16,r24
 165               	.LVL14:
 166 000a FC01      		movw r30,r24
  40:ram_utils.c   **** 
  41:ram_utils.c   **** 	/* quick & dirty strlen */
  42:ram_utils.c   **** 	int len = 1;
 167               		.loc 1 42 0
 168 000c C1E0      		ldi r28,lo8(1)
 169 000e D0E0      		ldi r29,0
 170               	.LVL15:
 171               	.L11:
 172               	.LBB5:
  43:ram_utils.c   **** 	const unsigned char* temp = source;
  44:ram_utils.c   **** 	while( pgm_read_byte(&(*(temp++))) != '\0')
 173               		.loc 1 44 0
 174               	/* #APP */
 175               	 ;  44 "ram_utils.c" 1
 176 0010 8491      		lpm r24, Z
 177               		
 178               	 ;  0 "" 2
 179               	.LVL16:
 180               	/* #NOAPP */
 181 0012 3196      		adiw r30,1
 182               	.LVL17:
 183               	.LBE5:
 184 0014 8111      		cpse r24,__zero_reg__
 185 0016 00C0      		rjmp .L12
  45:ram_utils.c   **** 		len++;
  46:ram_utils.c   **** 
  47:ram_utils.c   **** 	/* allocate memory */
  48:ram_utils.c   **** 	unsigned char* heap_alloc = (unsigned char*)malloc(len);
 186               		.loc 1 48 0
 187 0018 CE01      		movw r24,r28
 188               	.LVL18:
 189 001a 0E94 0000 		call malloc
 190               	.LVL19:
  49:ram_utils.c   **** 
  50:ram_utils.c   **** 	/* check we have heap space allocated */
  51:ram_utils.c   **** 	if(heap_alloc == NULL)
 191               		.loc 1 51 0
 192 001e 0097      		sbiw r24,0
 193 0020 01F0      		breq .L10
 194 0022 DC01      		movw r26,r24
 195 0024 20E0      		ldi r18,0
 196 0026 30E0      		ldi r19,0
 197               	.L14:
 198               	.LVL20:
 199               	.LBB6:
 200               	.LBB7:
  52:ram_utils.c   **** 		return NULL;
  53:ram_utils.c   **** 
  54:ram_utils.c   **** 	/* copy bytes over */
  55:ram_utils.c   **** 	for(int i=0;i<len;i++)
  56:ram_utils.c   **** 		heap_alloc[i] = pgm_read_byte(&((source[i])));
 201               		.loc 1 56 0 discriminator 3
 202 0028 F801      		movw r30,r16
 203 002a E20F      		add r30,r18
 204 002c F31F      		adc r31,r19
 205               	.LVL21:
 206               	/* #APP */
 207               	 ;  56 "ram_utils.c" 1
 208 002e E491      		lpm r30, Z
 209               		
 210               	 ;  0 "" 2
 211               	.LVL22:
 212               	/* #NOAPP */
 213               	.LBE7:
 214 0030 ED93      		st X+,r30
  55:ram_utils.c   **** 		heap_alloc[i] = pgm_read_byte(&((source[i])));
 215               		.loc 1 55 0 discriminator 3
 216 0032 2F5F      		subi r18,-1
 217 0034 3F4F      		sbci r19,-1
 218               	.LVL23:
 219 0036 C217      		cp r28,r18
 220 0038 D307      		cpc r29,r19
 221 003a 01F4      		brne .L14
 222               	.LVL24:
 223               	.L10:
 224               	/* epilogue start */
 225               	.LBE6:
  57:ram_utils.c   **** 
  58:ram_utils.c   **** 	/* return pointer to ram */
  59:ram_utils.c   **** 	return heap_alloc;
  60:ram_utils.c   **** }
 226               		.loc 1 60 0
 227 003c DF91      		pop r29
 228 003e CF91      		pop r28
 229               	.LVL25:
 230 0040 1F91      		pop r17
 231 0042 0F91      		pop r16
 232               	.LVL26:
 233 0044 0895      		ret
 234               	.LVL27:
 235               	.L12:
  45:ram_utils.c   **** 
 236               		.loc 1 45 0
 237 0046 2196      		adiw r28,1
 238               	.LVL28:
 239 0048 00C0      		rjmp .L11
 240               		.cfi_endproc
 241               	.LFE8:
 243               		.text
 244               	.Letext0:
 245               		.file 2 "/usr/avr/include/stdlib.h"
 246               		.file 3 "/usr/lib/gcc/avr/6.2.0/include/stddef.h"
 247               		.file 4 "/usr/avr/include/stdint.h"
DEFINED SYMBOLS
                            *ABS*:0000000000000000 ram_utils.c
     /tmp/ccOeXbtb.s:2      *ABS*:000000000000003e __SP_H__
     /tmp/ccOeXbtb.s:3      *ABS*:000000000000003d __SP_L__
     /tmp/ccOeXbtb.s:4      *ABS*:000000000000003f __SREG__
     /tmp/ccOeXbtb.s:5      *ABS*:0000000000000000 __tmp_reg__
     /tmp/ccOeXbtb.s:6      *ABS*:0000000000000001 __zero_reg__
     /tmp/ccOeXbtb.s:13     .text.estimate_alloc:0000000000000000 estimate_alloc
     /tmp/ccOeXbtb.s:34     .text.estimate_ram:0000000000000000 estimate_ram
     /tmp/ccOeXbtb.s:52     .text.load_rom_bitmap:0000000000000000 load_rom_bitmap
     /tmp/ccOeXbtb.s:139    .text.load_rom_string:0000000000000000 load_rom_string

UNDEFINED SYMBOLS
malloc
